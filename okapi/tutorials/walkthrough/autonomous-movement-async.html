

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Asynchronous Autonomous Movement &mdash; PROS for V5（中文） 3.1.6 文档</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

<link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  

  
        <link rel="index" title="索引"
              href="../../../genindex.html"/>
        <link rel="search" title="搜索" href="../../../search.html"/>
    <link rel="top" title="PROS for V5（中文） 3.1.6 文档" href="../../../index.html"/>
        <link rel="up" title="Tutorials" href="../index.html"/>
        <link rel="next" title="2D Motion Profiling" href="../concepts/2dmotionprofiling.html"/>
        <link rel="prev" title="Moving Autonomously" href="autonomous-movement-basic.html"/>
  
   
  
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>


  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> PROS for V5（中文）
          

          
            
            <img src="../../../_static/logo.svg" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                
                  V5 (3.1.6)
                
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">主页</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">PROS：文档主页</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../blog/index.html">博客</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/index.html">版本发行说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contact.html">获得帮助</a></li>
</ul>
<p class="caption"><span class="caption-text">入门</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/index.html">入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/new-users.html">PROS 初学者指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/installation.html">安装指南</a></li>
</ul>
<p class="caption"><span class="caption-text">教程</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">教程</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API 主页</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/c/index.html">C API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/cpp/index.html">C++ API</a></li>
</ul>
<p class="caption"><span class="caption-text">工具</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../cli/index.html">CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../editor/index.html">编辑器</a></li>
</ul>
<p class="caption"><span class="caption-text">OkapiLib</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">OkapiLib 文档主页</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../api/index.html">OkapiLib API</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Tutorials</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../index.html#walkthrough-tutorials">Walkthrough Tutorials</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="getting-started.html">Getting Started with OkapiLib</a></li>
<li class="toctree-l4"><a class="reference internal" href="clawbot.html">Programming the Clawbot</a></li>
<li class="toctree-l4"><a class="reference internal" href="lift-movement.html">Lift Movement</a></li>
<li class="toctree-l4"><a class="reference internal" href="autonomous-movement-basic.html">Moving Autonomously</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Asynchronous Autonomous Movement</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#topical-tutorials">Topical Tutorials</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#walkthrough-tutorials">Walkthrough Tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="getting-started.html">Getting Started with OkapiLib</a></li>
<li class="toctree-l3"><a class="reference internal" href="clawbot.html">Programming the Clawbot</a></li>
<li class="toctree-l3"><a class="reference internal" href="lift-movement.html">Lift Movement</a></li>
<li class="toctree-l3"><a class="reference internal" href="autonomous-movement-basic.html">Moving Autonomously</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Asynchronous Autonomous Movement</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#topical-tutorials">Topical Tutorials</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">OkapiLib API</a></li>
</ul>
<p class="caption"><span class="caption-text">扩展（高级用户）</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../extended/index.html">扩展 API 专题</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">PROS for V5（中文）</a>
        
      </nav>


      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">OkapiLib 文档主页</a> &raquo;</li>
        
          <li><a href="../index.html">Tutorials</a> &raquo;</li>
        
      <li>Asynchronous Autonomous Movement</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/MechDancer/pros-docs/blob/master/v5-chinese/okapi/tutorials/walkthrough/autonomous-movement-async.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="asynchronous-autonomous-movement">
<h1>Asynchronous Autonomous Movement<a class="headerlink" href="#asynchronous-autonomous-movement" title="永久链接至标题">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">This tutorial covers asynchronous movement (multiple subsystems operating at a time).
For a more basic tutorial on sequential movements, see <a class="reference external" href="./autonomous-movement-basic.html">Moving Autonomously</a>.</p>
</div>
<p>Oftentimes the fastest way to move in autonomous involves actuating multiple subsystems at once
(i.e. driving and raising/lowering a lift). This is made possible with
<a class="reference external" href="../../api/control/async/async-controller-factory.html">Async Controllers</a>.</p>
<p>To create a Chassis Controller for a given system, modify the below example to fit your subsystem.</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">okapi</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">DRIVE_LEFT_MOTOR_PORT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">DRIVE_RIGHT_MOTOR_PORT</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="k">auto</span> <span class="n">driveController</span> <span class="o">=</span> <span class="n">ChassisControllerFactory</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="n">DRIVE_LEFT_MOTOR_PORT</span><span class="p">,</span> <span class="n">DRIVE_RIGHT_MOTOR_PORT</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">autonomous</span><span class="p">()</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>And then we’ll add a lift subsystem as an Async Controller:</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">okapi</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">DRIVE_LEFT_MOTOR_PORT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">DRIVE_RIGHT_MOTOR_PORT</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">double</span> <span class="n">liftkP</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">liftkI</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">liftkD</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">LIFT_MOTOR_PORT</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="k">auto</span> <span class="n">driveController</span> <span class="o">=</span> <span class="n">ChassisControllerFactory</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="n">DRIVE_LEFT_MOTOR_PORT</span><span class="p">,</span> <span class="n">DRIVE_RIGHT_MOTOR_PORT</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">liftController</span> <span class="o">=</span> <span class="n">AsyncControllerFactory</span><span class="o">::</span><span class="n">posPID</span><span class="p">(</span><span class="n">LIFT_MOTOR_PORT</span><span class="p">,</span> <span class="n">liftkP</span><span class="p">,</span> <span class="n">liftkI</span><span class="p">,</span> <span class="n">liftkD</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">autonomous</span><span class="p">()</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Now that we have two subsystems to run, let’s execute a few different movements.</p>
<p>If we want both systems to move, and the next movement in the autonomous routine only depends on the drive
completing its movement (and it doesn’t care about the lift’s status), we’ll run <code class="docutils literal notranslate"><span class="pre">waitUntilSettled()</span></code>
with just the drive controller.</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">okapi</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">DRIVE_LEFT_MOTOR_PORT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">DRIVE_RIGHT_MOTOR_PORT</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">double</span> <span class="n">liftkP</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">liftkI</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">liftkD</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">LIFT_MOTOR_PORT</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="k">auto</span> <span class="n">driveController</span> <span class="o">=</span> <span class="n">ChassisControllerFactory</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="n">DRIVE_LEFT_MOTOR_PORT</span><span class="p">,</span> <span class="n">DRIVE_RIGHT_MOTOR_PORT</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">liftController</span> <span class="o">=</span> <span class="n">AsyncControllerFactory</span><span class="o">::</span><span class="n">posPID</span><span class="p">(</span><span class="n">LIFT_MOTOR_PORT</span><span class="p">,</span> <span class="n">liftkP</span><span class="p">,</span> <span class="n">liftkI</span><span class="p">,</span> <span class="n">liftkD</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">autonomous</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Begin movements</span>
  <span class="n">driveController</span><span class="p">.</span><span class="n">moveDistanceAsync</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="c1">// Move 1000 motor degrees forward</span>
  <span class="n">liftController</span><span class="p">.</span><span class="n">setTarget</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span> <span class="c1">// Move 200 motor degrees upward</span>
  <span class="n">driveController</span><span class="p">.</span><span class="n">waitUntilSettled</span><span class="p">();</span>

  <span class="c1">// Then the next movement will execute after the drive movement finishes</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>If blocking the next movement with regard only to the lift is desired, swap <code class="docutils literal notranslate"><span class="pre">driveController</span></code> for <code class="docutils literal notranslate"><span class="pre">liftController</span></code>
in the last line.</p>
<p>If both movements need to finish before executing the next movement, then call <code class="docutils literal notranslate"><span class="pre">waitUntilSettled()</span></code>
on both controllers.</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">okapi</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">DRIVE_LEFT_MOTOR_PORT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">DRIVE_RIGHT_MOTOR_PORT</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">double</span> <span class="n">liftkP</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">liftkI</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">liftkD</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">LIFT_MOTOR_PORT</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="k">auto</span> <span class="n">driveController</span> <span class="o">=</span> <span class="n">ChassisControllerFactory</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="n">DRIVE_LEFT_MOTOR_PORT</span><span class="p">,</span> <span class="n">DRIVE_RIGHT_MOTOR_PORT</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">liftController</span> <span class="o">=</span> <span class="n">AsyncControllerFactory</span><span class="o">::</span><span class="n">posPID</span><span class="p">(</span><span class="n">LIFT_MOTOR_PORT</span><span class="p">,</span> <span class="n">liftkP</span><span class="p">,</span> <span class="n">liftkI</span><span class="p">,</span> <span class="n">liftkD</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">autonomous</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Begin movements</span>
  <span class="n">driveController</span><span class="p">.</span><span class="n">moveDistanceAsync</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="c1">// Move 1000 motor degrees forward</span>
  <span class="n">liftController</span><span class="p">.</span><span class="n">setTarget</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span> <span class="c1">// Move 200 motor degrees upward</span>
  <span class="n">driveController</span><span class="p">.</span><span class="n">waitUntilSettled</span><span class="p">();</span>
  <span class="n">liftController</span><span class="p">.</span><span class="n">waitUntilSettled</span><span class="p">();</span>

  <span class="c1">// Then the next movement will execute after both movements finish</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>

  <div class="section">
  
  
  </div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../concepts/2dmotionprofiling.html" class="btn btn-neutral float-right" title="2D Motion Profiling" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="autonomous-movement-basic.html" class="btn btn-neutral" title="Moving Autonomously" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019 Purdue ACM SIGBots 根据 MPL 2.0 许可发布，MechDancer 译。

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Versions: </span>
      v: V5 (3.1.6)
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="../../../index.html">V5</a></dd>
        
      </dl>
    </div>
  </div>


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../_static/translations.js"></script>
    

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>