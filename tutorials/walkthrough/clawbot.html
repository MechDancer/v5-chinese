

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>为爪爪机器人编程 &mdash; PROS for V5（中文） 3.1.6 文档</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
    <link rel="stylesheet" href="../../_static/sphinx_tabs/tabs.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/sphinx_tabs/semantic-ui-2.2.10/segment.min.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/sphinx_tabs/semantic-ui-2.2.10/menu.min.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/sphinx_tabs/semantic-ui-2.2.10/tab.min.css" type="text/css" />
  

  
        <link rel="index" title="索引"
              href="../../genindex.html"/>
        <link rel="search" title="搜索" href="../../search.html"/>
    <link rel="top" title="PROS for V5（中文） 3.1.6 文档" href="../../index.html"/>
        <link rel="up" title="教程" href="../index.html"/>
        <link rel="next" title="创建一个 C 项目" href="creating-c-project.html"/>
        <link rel="prev" title="通用常见问题" href="../general/usage-faq.html"/>
  
   
  
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>


  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> PROS for V5（中文）
          

          
            
            <img src="../../_static/logo.svg" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                
                  V5 (3.1.6)
                
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">主页</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">PROS：文档主页</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../blog/index.html">博客</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/index.html">版本发行说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contact.html">获得帮助</a></li>
</ul>
<p class="caption"><span class="caption-text">入门</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.html">入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/new-users.html">PROS 初学者指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/installation.html">安装指南</a></li>
</ul>
<p class="caption"><span class="caption-text">教程</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">教程</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#id3">常规教程</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#id5">演练教程</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">为爪爪机器人编程</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">目的</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">目标受众</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">目标</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">爪爪机器人</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">创建项目</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pros">PROS 项目结构</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">遥控</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">街机控制</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">机械臂控制</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">爪爪控制</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">读取开关</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">简单自动</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="creating-c-project.html">创建一个 C 项目</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#id6">专题教程</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API 主页</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/c/index.html">C API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/cpp/index.html">C++ API</a></li>
</ul>
<p class="caption"><span class="caption-text">工具</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cli/index.html">CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../editor/index.html">编辑器</a></li>
</ul>
<p class="caption"><span class="caption-text">OkapiLib</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../okapi/index.html">OkapiLib 文档主页</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../okapi/tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../okapi/api/index.html">OkapiLib API</a></li>
</ul>
<p class="caption"><span class="caption-text">扩展（高级用户）</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../extended/index.html">Extended API Topics</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PROS for V5（中文）</a>
        
      </nav>


      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">教程</a> &raquo;</li>
        
      <li>为爪爪机器人编程</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/MechDancer/pros-docs/blob/master/v5-chinese/tutorials/walkthrough/clawbot.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>为爪爪机器人编程<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<div class="contents local topic" id="id2">
<ul class="simple">
<li><a class="reference internal" href="#id3" id="id29">目的</a></li>
<li><a class="reference internal" href="#id4" id="id30">目标受众</a></li>
<li><a class="reference internal" href="#id5" id="id31">目标</a></li>
<li><a class="reference internal" href="#id6" id="id32">爪爪机器人</a></li>
<li><a class="reference internal" href="#id8" id="id33">创建项目</a></li>
<li><a class="reference internal" href="#pros" id="id34">PROS 项目结构</a></li>
<li><a class="reference internal" href="#id9" id="id35">遥控</a></li>
<li><a class="reference internal" href="#id10" id="id36">街机控制</a></li>
<li><a class="reference internal" href="#id11" id="id37">机械臂控制</a></li>
<li><a class="reference internal" href="#id12" id="id38">爪爪控制</a></li>
<li><a class="reference internal" href="#id13" id="id39">读取开关</a></li>
<li><a class="reference internal" href="#id14" id="id40">简单自动</a></li>
</ul>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id29">目的</a><a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>本教程将指导您完成 VEX 爪爪机器人的基本编程。</p>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id30">目标受众</a><a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<p>本教程面向有一些编程经验，但对 PROS 库陌生的开发者。如果你以前从来没写过程序，我们推荐你查看<a class="reference external" href="http://www.studytonight.com/c/overview-of-c.php">这个教程系列</a>的《简介和基本 C 特性》。你也可以受益于“指针、数组和字符串部分”尽管它们并不相关。</p>
</div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id31">目标</a><a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<p>在本教程结束时，你将获得：</p>
<ul class="simple">
<li>理解 PROS 基本项目结构</li>
<li>会使用“坦克”或“街机”控制对基本底盘进行编程</li>
<li>编好的用于控制爪爪机器人机械臂升降的按钮</li>
<li>编好的用于控制爪爪的摇杆</li>
<li>理解标准子系统模块方法</li>
<li>编好的航位推算（dead-reckoned）自动例程</li>
</ul>
</div>
<div class="section" id="id6">
<h2><a class="toc-backref" href="#id32">爪爪机器人</a><a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<p>这是我们要编程的机器人：</p>
<img alt="../../_images/clawbot1.jpg" src="../../_images/clawbot1.jpg" />
<p>你可以根据 VEX 的<a class="reference external" href="https://v5beta.vex.com/parent-wrapper.php?id=v5-with-clawbot">教程</a>搭建这个机器人。</p>
<p>在本教程中，我们将电机插入了以下端口：</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="34%" />
<col width="17%" />
<col width="32%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Port</th>
<th class="head">Description</th>
<th class="head">Port</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Left Wheels</td>
<td>11</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>&#160;</td>
<td>12</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>3</td>
<td>Claw Motor</td>
<td>13</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>&#160;</td>
<td>14</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>5</td>
<td>Vision Sensor</td>
<td>15</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>6</td>
<td>&#160;</td>
<td>16</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>7</td>
<td>&#160;</td>
<td>17</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>8</td>
<td>Arm Motor</td>
<td>18</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>9</td>
<td>&#160;</td>
<td>19</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>10</td>
<td>Right Wheels</td>
<td>20</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>Port 21: Radio</p>
<p>ADI:</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="34%" />
<col width="17%" />
<col width="32%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Port</th>
<th class="head">Description</th>
<th class="head">Port</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>A</td>
<td>Left Bumper</td>
<td>E</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>B</td>
<td>Right Bumper</td>
<td>F</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>C</td>
<td>&#160;</td>
<td>G</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>D</td>
<td>&#160;</td>
<td>H</td>
<td>Arm Limit</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id8">
<h2><a class="toc-backref" href="#id33">创建项目</a><a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h2>
<p>在 Atom 启动后，你可以点击 <code class="docutils literal notranslate"><span class="pre">PROS</span></code> 菜单，点击 <code class="docutils literal notranslate"><span class="pre">Create</span> <span class="pre">new</span> <span class="pre">Project</span></code>
创建新的 PROS 项目。</p>
<p>创建一个目录，用于保存爪爪机器人项目的源文件。</p>
<p>选择要在其中创建新项目的目录，然后点击创建。PROS CLI 会把最新的内核模板复制到制定的目录中，然后 Atom 会打开它。</p>
</div>
<div class="section" id="pros">
<h2><a class="toc-backref" href="#id34">PROS 项目结构</a><a class="headerlink" href="#pros" title="永久链接至标题">¶</a></h2>
<p>创建项目时，PROS 将复制构建项目所需的所有文件。项目的结构如下：</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>project
│   project.pros        （PROS CLI 从这得知内核版本和其他元数据）
│   Makefile            （告诉 make 如何编译这个工程）
|   common.mk           （Makefile 的帮助文件）
│
└───src                 （源文件应该放在这里）
│   │   autonomous.cpp  （自动部分源码）
│   │   initialize.cpp  （初始化部分源码）
│   │   opcontrol.cpp   （遥控部分源码）
|
└───include             （头文件应该放在这里）
│   │   api.h           （让源码知道 PROS API 函数）
│   │   main.h          （`包含` api.h 和你希望在项目范围内 `包含` 的任何其他内容）
|   └───pros            （包含所有特定 PROS API 的头文件）
|   └───okapi           （包含所有 OkapiLib 的头文件）
|   └───display         （包含 V5 屏幕图形库 LVGL 的头文件）
│
└───firmware
    │   libpros.a       （编译好的 PROS 库）
    │   okapilib.a      （编译好的 OkapiLib）
    |   v5.ld           （告诉链接器如何为 V5 构造二进制文件）
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">按照惯例，<code class="docutils literal notranslate"><span class="pre">opcontrol()</span></code>、<code class="docutils literal notranslate"><span class="pre">autonomous()</span></code>，和初始化函数被分为单独的文件（opcontrol.cpp、autonomous.cpp、initialize.cpp）。他们可以在同一个文件中,但把函数组织到多个文件中对防止事情变得混乱很有帮助。</p>
</div>
</div>
<div class="section" id="id9">
<h2><a class="toc-backref" href="#id35">遥控</a><a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h2>
<p>让我们从最简单的爪爪机器人遥控——坦克驾驶控制开始。我们将会把左摇杆映射到左侧驱动电机，右摇杆映射到右侧驱动电机。</p>
<p>手柄的摇杆可以通过以下函数读值：</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-Qysr docutils container">
<div class="docutils container">
C++</div>
</div>
<div class="item sphinx-data-tab-Qw== docutils container">
<div class="docutils container">
C</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qysr active docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>std::int32_t pros::Controller::get_analog ( pros::controller_analog_e_t channel )
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qw== docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int32_t controller_get_analog ( controller_id_e_t id,
                                 controller_analog_e_t channel )
</pre></div>
</div>
</div>
</div>
<p>然后我们通过以下函数设置电机：</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-Qysr docutils container">
<div class="docutils container">
C++</div>
</div>
<div class="item sphinx-data-tab-Qw== docutils container">
<div class="docutils container">
C</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qysr active docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>std::int32_t motor_move ( const std::int8_t voltage )
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qw== docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int32_t motor_move ( uint8_t port,
                       const int8_t voltage )
</pre></div>
</div>
</div>
</div>
<p>在我们开始使用坦克驾驶控制之前，有一点需要注意。在 C++ 中，智能设备具有创建智能设备对象的 <cite>构造函数</cite>。构造函数是一个标准的 C++ 概念，它们非常重要，因为构造函数是为定义像电机或手柄这样对象的 <cite>类</cite>
所必须的。</p>
<p>我们先在 <code class="docutils literal notranslate"><span class="pre">opcontrol()</span></code> 开始时调用电机和手柄的构造器，然后运行坦克驾驶控制代码。</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-Qysr docutils container">
<div class="docutils container">
C++</div>
</div>
<div class="item sphinx-data-tab-Qw== docutils container">
<div class="docutils container">
C</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qysr active docutils container">
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">opcontrol.cpp</span><a class="headerlink" href="#id15" title="永久链接至代码">¶</a></div>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define LEFT_WHEELS_PORT 1</span>
<span class="cp">#define RIGHT_WHEELS_PORT 10</span>

<span class="kt">void</span> <span class="nf">opcontrol</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">left_wheels</span> <span class="p">(</span><span class="n">LEFT_WHEELS_PORT</span><span class="p">);</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">right_wheels</span> <span class="p">(</span><span class="n">RIGHT_WHEELS_PORT</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span> <span class="c1">// This reverses the motor</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Controller</span> <span class="n">master</span> <span class="p">(</span><span class="n">CONTROLLER_MASTER</span><span class="p">);</span>

  <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">left_wheels</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_analog</span><span class="p">(</span><span class="n">ANALOG_LEFT_Y</span><span class="p">));</span>
    <span class="n">right_wheels</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_analog</span><span class="p">(</span><span class="n">ANALOG_RIGHT_Y</span><span class="p">));</span>

    <span class="n">pros</span><span class="o">::</span><span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qw== docutils container">
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">opcontrol.c</span><a class="headerlink" href="#id16" title="永久链接至代码">¶</a></div>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define LEFT_WHEELS_PORT 1</span>
<span class="cp">#define RIGHT_WHEELS_PORT 10</span>

<span class="kt">void</span> <span class="nf">opcontrol</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">left</span> <span class="o">=</span> <span class="n">controller_get_analog</span><span class="p">(</span><span class="n">CONTROLLER_MASTER</span><span class="p">,</span> <span class="n">ANALOG_LEFT_Y</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">right</span> <span class="o">=</span> <span class="n">controller_get_analog</span><span class="p">(</span><span class="n">CONTROLLER_MASTER</span><span class="p">,</span> <span class="n">ANALOG_RIGHT_Y</span><span class="p">);</span>
    <span class="n">right</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// This will reverse the right motor</span>
    <span class="n">motor_move</span><span class="p">(</span><span class="n">LEFT_WHEELS_PORT</span><span class="p">,</span> <span class="n">left</span><span class="p">);</span>
    <span class="n">motor_move</span><span class="p">(</span><span class="n">RIGHT_WHEELS_PORT</span><span class="p">,</span> <span class="n">right</span><span class="p">);</span>

    <span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<p>要测试此代码，请在终端窗口中运行以下命令来创建、构建和上传。</p>
<div class="code bash highlight-none notranslate"><div class="highlight"><pre><span></span>prosv5 make
prosv5 upload
</pre></div>
</div>
<p>这两个命令可以简化为 <code class="docutils literal notranslate"><span class="pre">prosv5</span> <span class="pre">mu</span></code>。</p>
</div>
<div class="section" id="id10">
<h2><a class="toc-backref" href="#id36">街机控制</a><a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h2>
<p>虽然坦克驾驶控制非常适合一些人的驾驶风格，但也值得介绍街机控制方法。这类似于许多视频游戏的运动风格，其中一个摇杆轴覆盖向前/向后运动，另一个轴覆盖转动。</p>
<p>我们将采用以前的坦克驾驶控制代码，并稍微修改它，成为街机控制。摇杆的两轴值会经过求和或者作差作为左右两轮的功率。</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">译者注：原文最后句说的不明白，换了一种更直观的表达方式。</p>
</div>
</div></blockquote>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-Qysr docutils container">
<div class="docutils container">
C++</div>
</div>
<div class="item sphinx-data-tab-Qw== docutils container">
<div class="docutils container">
C</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qysr active docutils container">
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">opcontrol.cpp</span><a class="headerlink" href="#id17" title="永久链接至代码">¶</a></div>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define LEFT_WHEELS_PORT 1</span>
<span class="cp">#define RIGHT_WHEELS_PORT 10</span>

<span class="kt">void</span> <span class="nf">opcontrol</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">left_wheels</span> <span class="p">(</span><span class="n">LEFT_WHEELS_PORT</span><span class="p">);</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">right_wheels</span> <span class="p">(</span><span class="n">RIGHT_WHEELS_PORT</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Controller</span> <span class="n">master</span> <span class="p">(</span><span class="n">CONTROLLER_MASTER</span><span class="p">);</span>

  <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">power</span> <span class="o">=</span> <span class="n">master</span><span class="p">.</span><span class="n">get_analog</span><span class="p">(</span><span class="n">ANALOG_LEFT_Y</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">turn</span> <span class="o">=</span> <span class="n">master</span><span class="p">.</span><span class="n">get_analog</span><span class="p">(</span><span class="n">ANALOG_RIGHT_X</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">left</span> <span class="o">=</span> <span class="n">power</span> <span class="o">+</span> <span class="n">turn</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">right</span> <span class="o">=</span> <span class="n">power</span> <span class="o">-</span> <span class="n">turn</span><span class="p">;</span>
    <span class="n">left_wheels</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">left</span><span class="p">);</span>
    <span class="n">right_wheels</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">right</span><span class="p">);</span>

    <span class="n">pros</span><span class="o">::</span><span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qw== docutils container">
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">opcontrol.c</span><a class="headerlink" href="#id18" title="永久链接至代码">¶</a></div>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define LEFT_WHEELS_PORT 1</span>
<span class="cp">#define RIGHT_WHEELS_PORT 10</span>

<span class="kt">void</span> <span class="nf">opcontrol</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">power</span> <span class="o">=</span> <span class="n">controller_get_analog</span><span class="p">(</span><span class="n">CONTROLLER_MASTER</span><span class="p">,</span> <span class="n">ANALOG_LEFT_Y</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">turn</span> <span class="o">=</span> <span class="n">controller_get_analog</span><span class="p">(</span><span class="n">CONTROLLER_MASTER</span><span class="p">,</span> <span class="n">ANALOG_RIGHT_X</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">left</span> <span class="o">=</span> <span class="n">power</span> <span class="o">+</span> <span class="n">turn</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">right</span> <span class="o">=</span> <span class="n">power</span> <span class="o">-</span> <span class="n">turn</span><span class="p">;</span>
    <span class="n">right</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// This reverses the right motor</span>
    <span class="n">motor_move</span><span class="p">(</span><span class="n">LEFT_WHEELS_PORT</span><span class="p">,</span> <span class="n">left</span><span class="p">);</span>
    <span class="n">motor_move</span><span class="p">(</span><span class="n">RIGHT_WHEELS_PORT</span><span class="p">,</span> <span class="n">right</span><span class="p">);</span>

    <span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<p>与坦克驾驶代码一样，这可以通过 <code class="docutils literal notranslate"><span class="pre">prosv5</span> <span class="pre">mu</span></code> 命令上传。</p>
</div>
<div class="section" id="id11">
<h2><a class="toc-backref" href="#id37">机械臂控制</a><a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h2>
<p>接下来让我们控制爪爪机器人的机械臂。这不需要用摇杆，而是使用手柄的按钮。</p>
<p>我们通过以下函数读按钮的值：</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-Qysr docutils container">
<div class="docutils container">
C++</div>
</div>
<div class="item sphinx-data-tab-Qw== docutils container">
<div class="docutils container">
C</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qysr active docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>std::int32_t pros::Controller::get_digital ( pros::controller_digital_e_t button )
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qw== docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int32_t controller_get_digital ( controller_id_e_t id,
                                 controller_digital_e_t button )
</pre></div>
</div>
</div>
</div>
<p>我们将使用不同于传动系统（drive train）的电机运动函数。通过使用速度控制，
运动函数，我们可以确保升降以恒定速度移动而不需要考虑它承载的重量。</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-Qysr docutils container">
<div class="docutils container">
C++</div>
</div>
<div class="item sphinx-data-tab-Qw== docutils container">
<div class="docutils container">
C</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qysr active docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>std::int32_t pros::Motor::move_velocity ( const std::int32_t velocity )
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qw== docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int32_t motor_move_velocity ( uint8_t port,
                              const int32_t velocity )
</pre></div>
</div>
</div>
</div>
<p>要运动升降机械臂，我们检查最手柄右侧或左侧的扳机是否按下，如果是，就按照对应方向移动机械臂。</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-Qysr docutils container">
<div class="docutils container">
C++</div>
</div>
<div class="item sphinx-data-tab-Qw== docutils container">
<div class="docutils container">
C</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qysr active docutils container">
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">opcontrol.cpp</span><a class="headerlink" href="#id19" title="永久链接至代码">¶</a></div>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define LEFT_WHEELS_PORT 1</span>
<span class="cp">#define RIGHT_WHEELS_PORT 10</span>
<span class="cp">#define ARM_PORT 8</span>

<span class="kt">void</span> <span class="nf">opcontrol</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">left_wheels</span> <span class="p">(</span><span class="n">LEFT_WHEELS_PORT</span><span class="p">);</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">right_wheels</span> <span class="p">(</span><span class="n">RIGHT_WHEELS_PORT</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">arm</span> <span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="n">MOTOR_GEARSET_36</span><span class="p">);</span> <span class="c1">// 机械臂电机使用 100rpm（红色）齿轮组</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Controller</span> <span class="n">master</span> <span class="p">(</span><span class="n">CONTROLLER_MASTER</span><span class="p">);</span>

  <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">power</span> <span class="o">=</span> <span class="n">master</span><span class="p">.</span><span class="n">get_analog</span><span class="p">(</span><span class="n">ANALOG_LEFT_Y</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">turn</span> <span class="o">=</span> <span class="n">master</span><span class="p">.</span><span class="n">get_analog</span><span class="p">(</span><span class="n">ANALOG_RIGHT_X</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">left</span> <span class="o">=</span> <span class="n">power</span> <span class="o">+</span> <span class="n">turn</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">right</span> <span class="o">=</span> <span class="n">power</span> <span class="o">-</span> <span class="n">turn</span><span class="p">;</span>
    <span class="n">left_wheels</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">left</span><span class="p">);</span>
    <span class="n">right_wheels</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">right</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_R1</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">arm</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span> <span class="c1">// 因为是 100rpm 的电机，所以这是 100。</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_R2</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">arm</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">arm</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">pros</span><span class="o">::</span><span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qw== docutils container">
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">opcontrol.c</span><a class="headerlink" href="#id20" title="永久链接至代码">¶</a></div>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define LEFT_WHEELS_PORT 1</span>
<span class="cp">#define RIGHT_WHEELS_PORT 10</span>
<span class="cp">#define ARM_PORT 8</span>

<span class="kt">void</span> <span class="nf">opcontrol</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">motor_set_gearing</span><span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="n">MOTOR_GEARSET_36</span><span class="p">);</span> <span class="c1">// 机械臂电机使用 100rpm（红色）齿轮组</span>
  <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">power</span> <span class="o">=</span> <span class="n">controller_get_analog</span><span class="p">(</span><span class="n">CONTROLLER_MASTER</span><span class="p">,</span> <span class="n">ANALOG_LEFT_Y</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">turn</span> <span class="o">=</span> <span class="n">controller_get_analog</span><span class="p">(</span><span class="n">CONTROLLER_MASTER</span><span class="p">,</span> <span class="n">ANALOG_RIGHT_X</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">left</span> <span class="o">=</span> <span class="n">power</span> <span class="o">+</span> <span class="n">turn</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">right</span> <span class="o">=</span> <span class="n">power</span> <span class="o">-</span> <span class="n">turn</span><span class="p">;</span>
    <span class="n">right</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// This reverses the right motor</span>
    <span class="n">motor_move</span><span class="p">(</span><span class="n">LEFT_WHEELS_PORT</span><span class="p">,</span> <span class="n">left</span><span class="p">);</span>
    <span class="n">motor_move</span><span class="p">(</span><span class="n">RIGHT_WHEELS_PORT</span><span class="p">,</span> <span class="n">right</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_R1</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span> <span class="c1">// 因为是 100rpm 的电机，所以这是 100。</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_R2</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
</div>
<div class="section" id="id12">
<h2><a class="toc-backref" href="#id38">爪爪控制</a><a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h2>
<p>我们将以升降机械臂相同的方式控制爪爪，通过一个手柄上的按钮切换它的运动。</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-Qysr docutils container">
<div class="docutils container">
C++</div>
</div>
<div class="item sphinx-data-tab-Qw== docutils container">
<div class="docutils container">
C</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qysr active docutils container">
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">opcontrol.cpp</span><a class="headerlink" href="#id21" title="永久链接至代码">¶</a></div>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define LEFT_WHEELS_PORT 1</span>
<span class="cp">#define RIGHT_WHEELS_PORT 10</span>
<span class="cp">#define ARM_PORT 8</span>
<span class="cp">#define CLAW_PORT 3</span>

<span class="kt">void</span> <span class="nf">opcontrol</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">left_wheels</span> <span class="p">(</span><span class="n">LEFT_WHEELS_PORT</span><span class="p">);</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">right_wheels</span> <span class="p">(</span><span class="n">RIGHT_WHEELS_PORT</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">arm</span> <span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="n">MOTOR_GEARSET_36</span><span class="p">);</span> <span class="c1">// 机械臂电机使用 100rpm（红色）齿轮组</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">claw</span> <span class="p">(</span><span class="n">CLAW_PORT</span><span class="p">,</span> <span class="n">MOTOR_GEARSET_36</span><span class="p">);</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Controller</span> <span class="n">master</span> <span class="p">(</span><span class="n">CONTROLLER_MASTER</span><span class="p">);</span>

  <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">power</span> <span class="o">=</span> <span class="n">master</span><span class="p">.</span><span class="n">get_analog</span><span class="p">(</span><span class="n">ANALOG_LEFT_Y</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">turn</span> <span class="o">=</span> <span class="n">master</span><span class="p">.</span><span class="n">get_analog</span><span class="p">(</span><span class="n">ANALOG_RIGHT_X</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">left</span> <span class="o">=</span> <span class="n">power</span> <span class="o">+</span> <span class="n">turn</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">right</span> <span class="o">=</span> <span class="n">power</span> <span class="o">-</span> <span class="n">turn</span><span class="p">;</span>
    <span class="n">left_wheels</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">left</span><span class="p">);</span>
    <span class="n">right_wheels</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">right</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_R1</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">arm</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span> <span class="c1">// 因为是 100rpm 的电机，所以这是 100。</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_R2</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">arm</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">arm</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_L1</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">claw</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_L2</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">claw</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">claw</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">pros</span><span class="o">::</span><span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qw== docutils container">
<div class="literal-block-wrapper docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text">opcontrol.c</span><a class="headerlink" href="#id22" title="永久链接至代码">¶</a></div>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define LEFT_WHEELS_PORT 1</span>
<span class="cp">#define RIGHT_WHEELS_PORT 10</span>
<span class="cp">#define ARM_PORT 8</span>
<span class="cp">#define CLAW_PORT 3</span>

<span class="kt">void</span> <span class="nf">opcontrol</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">motor_set_gearing</span><span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="n">MOTOR_GEARSET_36</span><span class="p">);</span> <span class="c1">// 机械臂电机使用 100rpm（红色）齿轮组</span>
  <span class="n">motor_set_gearing</span><span class="p">(</span><span class="n">CLAW_PORT</span><span class="p">,</span> <span class="n">MOTOR_GEARSET_36</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">power</span> <span class="o">=</span> <span class="n">controller_get_analog</span><span class="p">(</span><span class="n">CONTROLLER_MASTER</span><span class="p">,</span> <span class="n">ANALOG_LEFT_Y</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">turn</span> <span class="o">=</span> <span class="n">controller_get_analog</span><span class="p">(</span><span class="n">CONTROLLER_MASTER</span><span class="p">,</span> <span class="n">ANALOG_RIGHT_X</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">left</span> <span class="o">=</span> <span class="n">power</span> <span class="o">+</span> <span class="n">turn</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">right</span> <span class="o">=</span> <span class="n">power</span> <span class="o">-</span> <span class="n">turn</span><span class="p">;</span>
    <span class="n">right</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// This reverses the right motor</span>
    <span class="n">motor_move</span><span class="p">(</span><span class="n">LEFT_WHEELS_PORT</span><span class="p">,</span> <span class="n">left</span><span class="p">);</span>
    <span class="n">motor_move</span><span class="p">(</span><span class="n">RIGHT_WHEELS_PORT</span><span class="p">,</span> <span class="n">right</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_R1</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span> <span class="c1">// 因为是 100rpm 的电机，所以这是 100。</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_R2</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_R1</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">CLAW_PORT</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span> <span class="c1">// 因为是 100rpm 的电机，所以这是 100。</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_R2</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">CLAW_PORT</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">CLAW_PORT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
</div>
<div class="section" id="id13">
<h2><a class="toc-backref" href="#id39">读取开关</a><a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h2>
<p>保险杠开关/按钮插入了 ADI 并装在了机器人的后部。我们会监控它的状态，如果它被按下了，则禁止机器人向后运动。</p>
<p>为此，我们将使用 ADI 数字信号读取功能。</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-Qysr docutils container">
<div class="docutils container">
C++</div>
</div>
<div class="item sphinx-data-tab-Qw== docutils container">
<div class="docutils container">
C</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qysr active docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>std::int32_t pros::ADIDigitalIn::get_value ( ) const
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qw== docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int32_t adi_get_value (uint8_t port )
</pre></div>
</div>
</div>
</div>
<p>下面是更新后的代码：</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-Qysr docutils container">
<div class="docutils container">
C++</div>
</div>
<div class="item sphinx-data-tab-Qw== docutils container">
<div class="docutils container">
C</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qysr active docutils container">
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text">opcontrol.cpp</span><a class="headerlink" href="#id23" title="永久链接至代码">¶</a></div>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define LEFT_WHEELS_PORT 1</span>
<span class="cp">#define RIGHT_WHEELS_PORT 10</span>
<span class="cp">#define ARM_PORT 8</span>
<span class="cp">#define CLAW_PORT 3</span>

<span class="cp">#define LEFT_BUMPER_PORT &#39;a&#39;</span>
<span class="cp">#define RIGHT_BUMPER_PORT &#39;b&#39;</span>

<span class="kt">void</span> <span class="nf">opcontrol</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">left_wheels</span> <span class="p">(</span><span class="n">LEFT_WHEELS_PORT</span><span class="p">);</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">right_wheels</span> <span class="p">(</span><span class="n">RIGHT_WHEELS_PORT</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">arm</span> <span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="n">MOTOR_GEARSET_36</span><span class="p">);</span> <span class="c1">// 机械臂电机使用 100rpm（红色）齿轮组</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">claw</span> <span class="p">(</span><span class="n">CLAW_PORT</span><span class="p">,</span> <span class="n">MOTOR_GEARSET_36</span><span class="p">);</span>

  <span class="n">pros</span><span class="o">::</span><span class="n">ADIDigitalIn</span> <span class="n">left_bumper</span> <span class="p">(</span><span class="n">LEFT_BUMPER_PORT</span><span class="p">);</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">ADIDigitalIn</span> <span class="n">right_bumper</span> <span class="p">(</span><span class="n">RIGHT_BUMPER_PORT</span><span class="p">);</span>

  <span class="n">pros</span><span class="o">::</span><span class="n">Controller</span> <span class="n">master</span> <span class="p">(</span><span class="n">CONTROLLER_MASTER</span><span class="p">);</span>

  <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">power</span> <span class="o">=</span> <span class="n">master</span><span class="p">.</span><span class="n">get_analog</span><span class="p">(</span><span class="n">ANALOG_LEFT_Y</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">turn</span> <span class="o">=</span> <span class="n">master</span><span class="p">.</span><span class="n">get_analog</span><span class="p">(</span><span class="n">ANALOG_RIGHT_X</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">left</span> <span class="o">=</span> <span class="n">power</span> <span class="o">+</span> <span class="n">turn</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">right</span> <span class="o">=</span> <span class="n">power</span> <span class="o">-</span> <span class="n">turn</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">left_bumper</span><span class="p">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">||</span> <span class="n">right_bumper</span><span class="p">.</span><span class="n">get_value</span><span class="p">())</span> <span class="p">{</span>
      <span class="c1">// One of the bump switches is currently pressed</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">left</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">right</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">left_wheels</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">left</span><span class="p">);</span>
    <span class="n">right_wheels</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">right</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_R1</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">arm</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span> <span class="c1">// 因为是 100rpm 的电机，所以这是 100。</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_R2</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">arm</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">arm</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_L1</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">claw</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_L2</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">claw</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">claw</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">pros</span><span class="o">::</span><span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qw== docutils container">
<div class="literal-block-wrapper docutils container" id="id24">
<div class="code-block-caption"><span class="caption-text">opcontrol.c</span><a class="headerlink" href="#id24" title="永久链接至代码">¶</a></div>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define LEFT_WHEELS_PORT 1</span>
<span class="cp">#define RIGHT_WHEELS_PORT 10</span>
<span class="cp">#define ARM_PORT 8</span>
<span class="cp">#define CLAW_PORT 3</span>

<span class="cp">#define LEFT_BUMPER_PORT &#39;a&#39;</span>
<span class="cp">#define RIGHT_BUMPER_PORT &#39;b&#39;</span>

<span class="kt">void</span> <span class="nf">opcontrol</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">motor_set_gearing</span><span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="n">MOTOR_GEARSET_36</span><span class="p">);</span> <span class="c1">// 机械臂电机使用 100rpm（红色）齿轮组</span>
  <span class="n">motor_set_gearing</span><span class="p">(</span><span class="n">CLAW_PORT</span><span class="p">,</span> <span class="n">MOTOR_GEARSET_36</span><span class="p">);</span>

  <span class="n">adi_port_set_config</span><span class="p">(</span><span class="n">LEFT_BUMPER_PORT</span><span class="p">,</span> <span class="n">ADI_DIGITAL_IN</span><span class="p">);</span>
  <span class="n">adi_port_set_config</span><span class="p">(</span><span class="n">RIGHT_BUMPER_PORT</span><span class="p">,</span> <span class="n">ADI_DIGITAL_IN</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">power</span> <span class="o">=</span> <span class="n">controller_get_analog</span><span class="p">(</span><span class="n">CONTROLLER_MASTER</span><span class="p">,</span> <span class="n">ANALOG_LEFT_Y</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">turn</span> <span class="o">=</span> <span class="n">controller_get_analog</span><span class="p">(</span><span class="n">CONTROLLER_MASTER</span><span class="p">,</span> <span class="n">ANALOG_RIGHT_X</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">left</span> <span class="o">=</span> <span class="n">power</span> <span class="o">+</span> <span class="n">turn</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">right</span> <span class="o">=</span> <span class="n">power</span> <span class="o">-</span> <span class="n">turn</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">adi_port_get_value</span><span class="p">(</span><span class="n">LEFT_BUMPER_PORT</span><span class="p">)</span> <span class="o">||</span> <span class="n">adi_port_get_value</span><span class="p">(</span><span class="n">RIGHT_BUMPER_PORT</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// One of the bump switches is currently pressed</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">left</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">right</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">right</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// This reverses the right motor</span>
    <span class="n">motor_move</span><span class="p">(</span><span class="n">LEFT_WHEELS_PORT</span><span class="p">,</span> <span class="n">left</span><span class="p">);</span>
    <span class="n">motor_move</span><span class="p">(</span><span class="n">RIGHT_WHEELS_PORT</span><span class="p">,</span> <span class="n">right</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_R1</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span> <span class="c1">// 因为是 100rpm 的电机，所以这是 100。</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_R2</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_R1</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">CLAW_PORT</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span> <span class="c1">// 因为是 100rpm 的电机，所以这是 100。</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_R2</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">CLAW_PORT</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">CLAW_PORT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<p>我们将使用类似的技术读取限位开关。如果按下限位开关，则阻止机械臂进一步下降。</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-Qysr docutils container">
<div class="docutils container">
C++</div>
</div>
<div class="item sphinx-data-tab-Qw== docutils container">
<div class="docutils container">
C</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qysr active docutils container">
<div class="literal-block-wrapper docutils container" id="id25">
<div class="code-block-caption"><span class="caption-text">opcontrol.cpp</span><a class="headerlink" href="#id25" title="永久链接至代码">¶</a></div>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define LEFT_WHEELS_PORT 1</span>
<span class="cp">#define RIGHT_WHEELS_PORT 10</span>
<span class="cp">#define ARM_PORT 8</span>
<span class="cp">#define CLAW_PORT 3</span>

<span class="cp">#define LEFT_BUMPER_PORT &#39;a&#39;</span>
<span class="cp">#define RIGHT_BUMPER_PORT &#39;b&#39;</span>
<span class="cp">#define ARM_LIMIT_SWITCH_PORT &#39;h&#39;</span>

<span class="kt">void</span> <span class="nf">opcontrol</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">left_wheels</span> <span class="p">(</span><span class="n">LEFT_WHEELS_PORT</span><span class="p">);</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">right_wheels</span> <span class="p">(</span><span class="n">RIGHT_WHEELS_PORT</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">arm</span> <span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="n">MOTOR_GEARSET_36</span><span class="p">);</span> <span class="c1">// 机械臂电机使用 100rpm（红色）齿轮组</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">claw</span> <span class="p">(</span><span class="n">CLAW_PORT</span><span class="p">,</span> <span class="n">MOTOR_GEARSET_36</span><span class="p">);</span>

  <span class="n">pros</span><span class="o">::</span><span class="n">ADIDigitalIn</span> <span class="n">left_bumper</span> <span class="p">(</span><span class="n">LEFT_BUMPER_PORT</span><span class="p">);</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">ADIDigitalIn</span> <span class="n">right_bumper</span> <span class="p">(</span><span class="n">RIGHT_BUMPER_PORT</span><span class="p">);</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">ADIDigitalIn</span> <span class="n">arm_limit</span> <span class="p">(</span><span class="n">ARM_LIMIT_SWITCH_PORT</span><span class="p">);</span>

  <span class="n">pros</span><span class="o">::</span><span class="n">Controller</span> <span class="n">master</span> <span class="p">(</span><span class="n">CONTROLLER_MASTER</span><span class="p">);</span>

  <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">power</span> <span class="o">=</span> <span class="n">master</span><span class="p">.</span><span class="n">get_analog</span><span class="p">(</span><span class="n">ANALOG_LEFT_Y</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">turn</span> <span class="o">=</span> <span class="n">master</span><span class="p">.</span><span class="n">get_analog</span><span class="p">(</span><span class="n">ANALOG_RIGHT_X</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">left</span> <span class="o">=</span> <span class="n">power</span> <span class="o">+</span> <span class="n">turn</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">right</span> <span class="o">=</span> <span class="n">power</span> <span class="o">-</span> <span class="n">turn</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">left_bumper</span><span class="p">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">||</span> <span class="n">right_bumper</span><span class="p">.</span><span class="n">get_value</span><span class="p">())</span> <span class="p">{</span>
      <span class="c1">// One of the bump switches is currently pressed</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">left</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">right</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">left_wheels</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">left</span><span class="p">);</span>
    <span class="n">right_wheels</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">right</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_R1</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">arm</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span> <span class="c1">// 因为是 100rpm 的电机，所以这是 100。</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_R2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">arm_limit</span><span class="p">.</span><span class="n">get_value</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">arm</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">arm</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_L1</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">claw</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">DIGITAL_L2</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">claw</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">claw</span><span class="p">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">pros</span><span class="o">::</span><span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qw== docutils container">
<div class="literal-block-wrapper docutils container" id="id26">
<div class="code-block-caption"><span class="caption-text">opcontrol.c</span><a class="headerlink" href="#id26" title="永久链接至代码">¶</a></div>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define LEFT_WHEELS_PORT 1</span>
<span class="cp">#define RIGHT_WHEELS_PORT 10</span>
<span class="cp">#define ARM_PORT 8</span>
<span class="cp">#define CLAW_PORT 3</span>

<span class="cp">#define LEFT_BUMPER_PORT &#39;a&#39;</span>
<span class="cp">#define RIGHT_BUMPER_PORT &#39;b&#39;</span>
<span class="cp">#define ARM_LIMIT_SWITCH_PORT &#39;h&#39;</span>

<span class="kt">void</span> <span class="nf">opcontrol</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">motor_set_gearing</span><span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="n">GEARSET_36</span><span class="p">);</span> <span class="c1">// 机械臂电机使用 100rpm（红色）齿轮组</span>
  <span class="n">motor_set_gearing</span><span class="p">(</span><span class="n">CLAW_PORT</span><span class="p">,</span> <span class="n">GEARSET_36</span><span class="p">);</span>

  <span class="n">adi_port_set_config</span><span class="p">(</span><span class="n">LEFT_BUMPER_PORT</span><span class="p">,</span> <span class="n">ADI_DIGITAL_IN</span><span class="p">);</span>
  <span class="n">adi_port_set_config</span><span class="p">(</span><span class="n">RIGHT_BUMPER_PORT</span><span class="p">,</span> <span class="n">ADI_DIGITAL_IN</span><span class="p">);</span>
  <span class="n">adi_port_set_config</span><span class="p">(</span><span class="n">ARM_LIMIT_SWITCH_PORT</span><span class="p">,</span> <span class="n">ADI_DIGITAL_IN</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">power</span> <span class="o">=</span> <span class="n">controller_get_analog</span><span class="p">(</span><span class="n">CONTROLLER_MASTER</span><span class="p">,</span> <span class="n">CONTROLLER_ANALOG_LEFT_Y</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">turn</span> <span class="o">=</span> <span class="n">controller_get_analog</span><span class="p">(</span><span class="n">CONTROLLER_MASTER</span><span class="p">,</span> <span class="n">CONTROLLER_ANALOG_RIGHT_X</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">left</span> <span class="o">=</span> <span class="n">power</span> <span class="o">+</span> <span class="n">turn</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">right</span> <span class="o">=</span> <span class="n">power</span> <span class="o">-</span> <span class="n">turn</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">adi_port_get_value</span><span class="p">(</span><span class="n">LEFT_BUMPER_PORT</span><span class="p">)</span> <span class="o">||</span> <span class="n">adi_port_get_value</span><span class="p">(</span><span class="n">RIGHT_BUMPER_PORT</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// One of the bump switches is currently pressed</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">left</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">right</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">right</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">right</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// This reverses the right motor</span>
    <span class="n">motor_move</span><span class="p">(</span><span class="n">LEFT_WHEELS_PORT</span><span class="p">,</span> <span class="n">left</span><span class="p">);</span>
    <span class="n">motor_move</span><span class="p">(</span><span class="n">RIGHT_WHEELS_PORT</span><span class="p">,</span> <span class="n">right</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">CONTROLLER_DIGITAL_R1</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span> <span class="c1">// 因为是 100rpm 的电机，所以这是 100。</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">CONTROLLER_DIGITAL_R2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">adi_port_get_value</span><span class="p">(</span><span class="n">ARM_LIMIT_SWITCH_PORT</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">ARM_PORT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">CONTROLLER_DIGITAL_R1</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">CLAW_PORT</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span> <span class="c1">// 因为是 100rpm 的电机，所以这是 100。</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="n">get_digital</span><span class="p">(</span><span class="n">CONTROLLER_DIGITAL_R2</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">CLAW_PORT</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">motor_move_velocity</span><span class="p">(</span><span class="n">CLAW_PORT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
</div>
<div class="section" id="id14">
<h2><a class="toc-backref" href="#id40">简单自动</a><a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h2>
<p>自动程序运行时不使用手柄。我们将写一个简单的向前直走自动程序。</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-Qysr docutils container">
<div class="docutils container">
C++</div>
</div>
<div class="item sphinx-data-tab-Qw== docutils container">
<div class="docutils container">
C</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qysr active docutils container">
<div class="literal-block-wrapper docutils container" id="id27">
<div class="code-block-caption"><span class="caption-text">autonomous.cpp</span><a class="headerlink" href="#id27" title="永久链接至代码">¶</a></div>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define LEFT_WHEELS_PORT 1</span>
<span class="cp">#define RIGHT_WHEELS_PORT 10</span>
<span class="cp">#define MOTOR_MAX_SPEED 100 </span><span class="c1">// 电机使用 36 号齿轮组</span>

<span class="kt">void</span> <span class="nf">autonomous</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">left_wheels</span> <span class="p">(</span><span class="n">LEFT_WHEELS_PORT</span><span class="p">);</span>
  <span class="n">pros</span><span class="o">::</span><span class="n">Motor</span> <span class="n">right_wheels</span> <span class="p">(</span><span class="n">RIGHT_WHEELS_PORT</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span> <span class="c1">// This reverses the motor</span>

  <span class="n">right_wheels</span><span class="p">.</span><span class="n">move_relative</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">MOTOR_MAX_SPEED</span><span class="p">);</span>
  <span class="n">left_wheels</span><span class="p">.</span><span class="n">move_relative</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">MOTOR_MAX_SPEED</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-Qw== docutils container">
<div class="literal-block-wrapper docutils container" id="id28">
<div class="code-block-caption"><span class="caption-text">autonomous.c</span><a class="headerlink" href="#id28" title="永久链接至代码">¶</a></div>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define LEFT_WHEELS_PORT 1</span>
<span class="cp">#define RIGHT_WHEELS_PORT 10</span>
<span class="cp">#define MOTOR_MAX_SPEED 100 </span><span class="c1">// 电机使用 36 号齿轮组</span>

<span class="kt">void</span> <span class="nf">autonomous</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">motor_move_relative</span><span class="p">(</span><span class="n">LEFT_WHEELS_PORT</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">MOTOR_MAX_SPEED</span><span class="p">);</span>
  <span class="n">motor_move_relative</span><span class="p">(</span><span class="n">RIGHT_WHEELS_PORT</span><span class="p">,</span> <span class="o">-</span><span class="mi">1000</span><span class="p">,</span> <span class="n">MOTOR_MAX_SPEED</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
</div>
</div>

  <div class="section">
  
  
  </div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="creating-c-project.html" class="btn btn-neutral float-right" title="创建一个 C 项目" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../general/usage-faq.html" class="btn btn-neutral" title="通用常见问题" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019 Purdue ACM SIGBots 根据 MPL 2.0 许可发布，MechDancer 译。

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Versions: </span>
      v: V5 (3.1.6)
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="../../index.html">V5</a></dd>
        
      </dl>
    </div>
  </div>


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../_static/sphinx_tabs/tabs.js"></script>
        <script type="text/javascript" src="../../_static/sphinx_tabs/semantic-ui-2.2.10/tab.min.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>